# ![logo](https://i.imgur.com/zqJELkl.png)
<p align="center">
 <img src="https://img.shields.io/badge/License-MIT-blue.svg">
 <img src="https://badges.frapsoft.com/os/v3/open-source.svg?v=103">
 <img src="http://ForTheBadge.com/images/badges/built-with-love.svg">
 <img src="https://img.shields.io/badge/badges-awesome-green.svg">
 <img src="https://img.shields.io/badge/Stay-Safe-red?logo=data:image/svg%2bxml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTEwIDUxMCIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCA1MTAgNTEwIiB3aWR0aD0iNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxnPjxwYXRoIGQ9Im0xNzQuNjEgMzAwYy0yMC41OCAwLTQwLjU2IDYuOTUtNTYuNjkgMTkuNzJsLTExMC4wOSA4NS43OTd2MTA0LjQ4M2g1My41MjlsNzYuNDcxLTY1aDEyNi44MnYtMTQ1eiIgZmlsbD0iI2ZmZGRjZSIvPjwvZz48cGF0aCBkPSJtNTAyLjE3IDI4NC43MmMwIDguOTUtMy42IDE3Ljg5LTEwLjc4IDI0LjQ2bC0xNDguNTYgMTM1LjgyaC03OC4xOHYtODVoNjguMThsMTE0LjM0LTEwMC4yMWMxMi44Mi0xMS4yMyAzMi4wNi0xMC45MiA0NC41LjczIDcgNi41NSAxMC41IDE1LjM4IDEwLjUgMjQuMnoiIGZpbGw9IiNmZmNjYmQiLz48cGF0aCBkPSJtMzMyLjgzIDM0OS42M3YxMC4zN2gtNjguMTh2LTYwaDE4LjU1YzI3LjQxIDAgNDkuNjMgMjIuMjIgNDkuNjMgNDkuNjN6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTM5OS44IDc3LjN2OC4wMWMwIDIwLjY1LTguMDQgNDAuMDctMjIuNjQgNTQuNjdsLTExMi41MSAxMTIuNTF2LTIyNi42NmwzLjE4LTMuMTljMTQuNi0xNC42IDM0LjAyLTIyLjY0IDU0LjY3LTIyLjY0IDQyLjYyIDAgNzcuMyAzNC42OCA3Ny4zIDc3LjN6IiBmaWxsPSIjZDAwMDUwIi8+PHBhdGggZD0ibTI2NC42NSAyNS44M3YyMjYuNjZsLTExMi41MS0xMTIuNTFjLTE0LjYtMTQuNi0yMi42NC0zNC4wMi0yMi42NC01NC42N3YtOC4wMWMwLTQyLjYyIDM0LjY4LTc3LjMgNzcuMy03Ny4zIDIwLjY1IDAgNDAuMDYgOC4wNCA1NC42NiAyMi42NHoiIGZpbGw9IiNmZjRhNGEiLz48cGF0aCBkPSJtMjEyLjgzIDM2MC4xMnYzMGg1MS44MnYtMzB6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTI2NC42NSAzNjAuMTJ2MzBoMzYuMTRsMzIuMDQtMzB6IiBmaWxsPSIjZmZiZGE5Ii8+PC9nPjwvc3ZnPg==">
 
<p align="center">
 <img src="https://github.com/websemantics/bragit/blob/master/demo/img/heart.svg" height=40px >
 <img src="https://stars.medv.io/Naereen/badges.svg">

</p>
<p align="center">
    <a href="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge" alt="GitHub Repo stars">
        <img src="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge"></a>
    <a href="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge" alt="GitHub forks">
        <img src="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge"></a>
    <a href="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge" alt="GitHub watchers">
        <img src="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge"></a>
</p>
 
 
<h1 align="center"><b>A step by step ğŸ“œ guide for these</b> </h1>
<h1 align="center"><b> ğŸ…µğŸ†ğŸ…´ğŸ…´ network ğŸ“¡ security projects to work together on a</b> </h1>
<h1 align="center"><b>ğ“¡ ğ“ ğ“¢ ğ“Ÿ ğ“‘ ğ“” ğ“¡ ğ“¡ ğ“¨ â„™ ğ•€ ğŸ¥§</b> </h1>

#

#### _<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>AdGuard</b></a>_ â«¸ Adblocker for your devices at home ( <a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md#how-does-adguard-home-compare-to-pi-hole"><b>_AdGuard compared to Pi-Hole_</b></a> )
#### _<a href="https://www.wireguard.com/"><b>WireGuard</b></a>_ â«¸ A Vpn Server at home accessable from any outside network(IPv4 & IPv6)
#### _<a href="https://www.nlnetlabs.nl/projects/unbound/about/"><b>Unbound</b></a> with <a href="https://dnsprivacy.org/dns_privacy_daemon_-_stubby/about_stubby/"><b>Stubby</b></a>_ â«¸ A Validating, Recursive, Caching DNS Resolver
#### _<a href="https://www.cloudflare.com/learning/what-is-cloudflare/"><b>Cloudflare</b></a>_ â«¸ Better Performance & Security when browsing websites(DoT & DoH)
#
<p align="center">
 <img src="https://i.imgur.com/Z9bTcCu.png" >
 
<p align="center">
 <img src="https://i.imgur.com/ni6U1FW.jpg" >
 
<p align="center">
 <img src="https://i.imgur.com/owaA8kD.jpg" >
  
***
#
<h1 align="center">ğŸ“ˆ Test results with <a href="https://docs.oracle.com/en-us/iaas/Content/DNS/Tasks/testingdnsusingdig.htm"><b>BIND's DNS Tool </b></a> ğŸ“ˆ</h1>

<b>Query Time in milliseconds:</b>
- Adguard default DNS resolvers - `60-70 msec`
- Default Cloudflare/Quad9/Google DNS Resolvers - `50-70 msec`
- This set up/configuration -  `5-10 msec`
 

<details><summary><b>CLICK</b> (ğŸ¥Video 1)</summary>
<p>

### Adguard default DNS resolvers vs This set up/configuration
 
https://user-images.githubusercontent.com/18756975/150230438-b767e86f-4e18-4791-b5fe-0813615a37a3.mp4

</p>
</details>
 
<details><summary><b>CLICK</b> (ğŸ¥Video 2)</summary>
<p>

### Cloudflare/Quad9/Google DNS Resolvers
 
https://user-images.githubusercontent.com/18756975/150319049-3d8acdc9-624f-4b60-8ee2-b80227522252.mp4

</p>
</details>

***
 
<p align="center">
Last Checked : 14 Jan 2022
 
<div align="center">
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Projects  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           |   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Status &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         |
  :---:             |     :---: 
AdGuard Home        |       âœ…
Unbound             |       âœ…
Cloudflare          |       âœ…
Stubby              |       âœ…
WireGuard           |       âœ…    

</div>
<div>

#
# Contents
- <a href="https://git.io/About">About</a>
- [Requirements](#requirements)
- [Installing Pi operating system](#-installing-os-image-to-sdcard--)
  - [Logging into Pi system [Headlessly]](#-logging-into-pi-system-headlessly-)
- [Installing AdGuard](#-adguard-install--)
  - [Set up your devices to work with Adguard](#-set-up-your-devices-to-work-with-adguard-)
  - [Setting up AdGuard blocklist](#-setting-up-adguard-blocklist-)
    - [Add/Remove multiple URLs to blocklist at once](#-addremove-multiple-urls-)
- [Installing Unbound](#-unbound-install--)
- [Installing Cloudflare](#-cloudflare-install--)
  - [Install Cloudflare (DoH)](#-install-cloudflare-on-pi-with-doh-)
  - [Configure Cloudflare on Unbound (DoT)](#-configure-cloudflare-on-unbound-with-dot-)
  - [Configure Stubby (TLS Forwarder)](#-configure-stubby-for-unbound-)
  - [Configure AdGuard with Cloudflare (DoH&DoT)](#-configure-adguard-with-cloudflaredohdot-)
- [Installing WireGuard](#-wireguard-install--)
  or <a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md">OpenVPN(slower)</a>
  - [Connecting to the VPN to Android/IOS Phone](#-connecting-to-the-vpn-to-androidios-phone-)
  - [Connecting to the VPN from a PC (Windows)](#-connecting-to-the-vpn-from-a-pc-windows-)
  - [Configure Wireguard with AdGuard/Unbound/Cloudflare](#-configure-wireguard-with-adguardunboundcloudflare-)
    - [Limit traffic for faster connection](#limit-traffic-for-faster-speed-only-when-connected-to-wifi)
    - [IPv6 setup](#ipv6)
- <a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/Disable-All-IPv6.md">Disable all IPv6</a>
- [Test Vpn](#how-do-you-know-if-wireguard-vpn-is-really-working-)
- [Auto update your Pi](#-auto-update-pi--)
- [Improving your SD Cardâ€™s potential lifespan](#-log2ram-install--)
- [Turn Off Pi LEDs](#-turn-off-pi-led-lights--)
- [Securing your Raspberry Pi](#-secure-your-raspberry-pi--)

#
# Requirements
   
   * A Raspberry Pi 3 or 4 version
   * A router that supports port forwarding(Most Can)
   * MicroSD USB card reader
   * MicroSD card (8GB or bigger, at least Class 4)
   * Ethernet cable
   * (Optional if using monitor) MicroHDMI-(RPi 4) or HDMI-(RPi 3)

#
<p align="center">
  <b>ğŸ‘£ STEP 1 ğŸ‘£</b>

<h1 align="center"><b><i>â˜· Installing OS Image To SDcard â˜·</b></i> </h1>

This tutorial is based on Raspberry Pi OS (32bit or 64bit), but you can use any linux <a href="https://github.com/thibmaek/awesome-raspberry-pi#os-images"><b>operating system</b></a> and hardware you prefer if you know what you are doing.

Raspberry Pi OS comes in Desktop and Lite versions(I use lite). You can set Raspberry Pi up with a monitor/keyboard/mouse, or set it up â€œheadlesslyâ€ from a terminal.

Install balenEtcher and download pi image to write on the microSD card.

* Download Raspberry Pi OS: https://www.raspberrypi.org/software/operating-systems/

* Download balenaEtcher: https://www.balena.io/etcher/

After you have `Etcher` installed and `Raspberry Pi OS` file downloaded on your computer, you can now insert the SD card with microSD USB card reader into your computer.

Launch Etcher and choose the Raspberry Pi OS image that you downloaded, select your microSD card and click â€œFlashâ€.

<p align="center">
 <img src="https://i.imgur.com/tbB3VIK.jpg">

After flashing is done, look in "This PCâ€ for a disk name â€œboot or usb driveâ€ (replug usb card reader if not seen). Go to that disk, create a new text file called **_`ssh without 'txt' extention`_**. BE CAREFUL, it's not â€œssh.txtâ€, it's â€œsshâ€ without the extension. You need to disabled â€œHide extensions for known file typesâ€ option in the File Exporer Options if you don't see them.

<p align="center">
 <img src="https://i.imgur.com/eV6uMbz.jpg">

Now put the SD card into the Raspberry Pi, plug your Ethernet cable and boot up.

## â•¸ Logging into Pi system [Headlessly] â•¸

* Now you need to wait for a minute for pi's first boot up

* Open browser and log in your router's panel page

* Find list all of the devices connected to the network and copy the IP address of the Raspberry Pi (it will most likely have the hostname `raspberrypi`)

* Open Terminal on your host machine. You can use PowerShell on Windows or RaspController for Android

Type the following command:

    ssh pi@pi's ip address
    
You can use right mouse button to paste text in Windows PowerShell.

Type â€œyesâ€ for fingerprint question, and type "raspberry" for a password. The passwords will be invisible when typing in linux interface. You can type **_`sudo passwd pi`_** to change password.

<p align="center">
 <img src="https://i.imgur.com/Wf30jxG.jpg">

Run in terminal:
 
    sudo apt update -y && sudo apt upgrade -y
    
*_WAIT FOR UPDATE TO FINISH & RESTART PI. THEN CONTINUE TO NEXT STEP_*.....

    sudo reboot
 
**[â¬† BACK TO TOP â¬†](#contents)**

#
<p align="center">
 <b>ğŸ‘£ STEP 2 ğŸ‘£</b>

<h1 align="center"><b><i>â˜· AdGuard Install â˜·</b></i> </h1>

This installation script is from <a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>AdGuard Home</b></a> main project. Follow to keep updated.

Run the following command in your terminal:

    curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v

* When installation is finished a window will pop up showing the links to YOUR Adguard home page(Get Started)

* In Listen Interfaces option choose `Eth0` and select next

<p align="center">
 <img src="https://i.imgur.com/Wa00lDp.jpg" width=580px height=690px>

* Set up username and password

* You should now be in Adguard home panel

* `IMPORTANT:` In general settings, set "Query logs retention" to `24 hours` (I read that for some people logs fill up and slow down pi and needing a restart everytime)

## â•¸ Set Up Your Devices To Work With Adguard â•¸

- For Android/Apple, go to wifi advanced settings and select static option. In `DNS 1` field enter "pi's ip" address

<p align="center">
 <img src="https://i.imgur.com/nxpiqDw.jpg" width=450px height=580px>

- For PC/Windows
 
   - <i>IPV4</i>
 
   Go to network settings / change adpater options and right click in properties then select "Internet Protocol Version 4(TCP/IPv4)". Enter pi's ip address in `Preferred DNS` server 

   - <i>IPV6 (needed for `DoH` & `DoT` to work (later on in guide) if using ipv6 on your router</i>
 
    Go to "Internet Protocol Version 6(TCP/IPv6)" Enter pi's ipv6 address in `Preferred DNS` server (to get it enter `ifconfig` in pi's terminal and look for the second inet6 address(link). For example fe80::1179:a6ab:ae4e:ab12 )

<p align="center">
 <img src="https://i.imgur.com/8gsDk3z.jpg">

## â•¸ Setting Up AdGuard Blocklist â•¸
 
In AdGuard homepage under filters select blocklist section for adding and updating your urls.
 
<p align="center">
 <img src="https://i.imgur.com/shrtJLD.png">

You can search Google for different blocklist.Here is my custom <a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/My-Blocklist.txt"><b>blocklist</b></a> with my urls.
 
`IMPORTANT:` Some blocklist can block some important contents or websites. To unblock go "Query Log" section and can be simply unblock, putting it in "Custom filtering rules". Just look for client ip & time.  
 
<p align="center">
 <img src="https://i.imgur.com/OKUcoMs.jpg">

## â•¸ Add/Remove Multiple URLs â•¸

You can only add one by one url in dns blocklist in adguard for now but there is a python script to add multiple urls together.

Open new py file and call it bulkurls.py:

    nano /home/pi/bulkurls.py
    
Then copy and past text from <a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/bulkurls.py"><b>bulkurls.py</b></a> file and save (control+x then y then enter) **DON'T FORGET TO READ INSTRUCTIONS FROM TEXT IN IT**.
 
To remove you need to change `add` in second of last line **(..../control/filtering/`add`_url", data = filterObj, headers=headers)** to `remove` in bulkurls.py file.
 
**[â¬† BACK TO TOP â¬†](#contents)**

#
<p align="center">
 <b>ğŸ‘£ STEP 3 ğŸ‘£</b>

<h1 align="center"><b><i>â˜· Unbound Install â˜·</b></i> </h1>

Run the following command in your terminal:

    sudo apt install unbound -y
    
For recursively querying a host that is not cached as an address, the resolver needs to start at the top of the server tree and query the root servers, to know where to go for the top level domain for the address being queried. Unbound comes with default builtin hints.

    wget -O root.hints https://www.internic.net/domain/named.root && sudo mv root.hints /var/lib/unbound/
    
`IMPORTANT:` This needs to update every 6 months. To _**autoupdate**_ root.hints every 6 months you need to create a cron job.

Enter in command line `crontab -e`, it will ask Select an editor(choose 1) and paste these lines at the bottom of crontab and save (control+x then y then enter):

    1 0 1 */6 * wget -O root.hints https://www.internic.net/domain/named.root
    2 0 1 */6 * sudo mv root.hints /var/lib/unbound/
    
<p align="center">
 <img src="https://i.imgur.com/26ro62t.jpg">
 
**[â¬† BACK TO TOP â¬†](#contents)**

#    
<p align="center">
 <b>ğŸ‘£ STEP 4 ğŸ‘£</b>   

<h1 align="center"><b><i>â˜· Cloudflare Install â˜·</b></i> </h1>

## â•¸ Install Cloudflare On Pi With `(DoH)` â•¸

Install cloudflare with DNS over HTTPS(DoH), follow these ğŸ‘‰ <a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Cloudflare-DoH-Setup.md"><b>INSTRUCTIONS</b></a> ğŸ‘ˆ.

## â•¸ Configure Cloudflare On Unbound With `(DoT)` â•¸

Create unbound configuration file by entering in command prompt:
      
    sudo nano /etc/unbound/unbound.conf.d/unbound.conf

And copy and paste all the text from <a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/unbound.conf"><b>unbound.conf</b></a> file and save (control+x then y then enter).

## â•¸ Configure Stubby For Unbound â•¸

Use Unbound for caching and stubby for TLS forwarder. Install stubby:

    sudo apt install stubby -y
    
Remove and re-create stubby.yaml file and copy/paste all the text from <a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/stubby.yml"><b>ğŸ‘‰ this stubby config ğŸ‘ˆ</b></a> and save. (`cd $home` to return to home folder when finish).

    cd /etc/stubby/ && sudo rm stubby.yml && sudo nano stubby.yml
    
Tip : You can also add more DNS servers by uncommenting the needed lines
 
 ## â•¸ Configure Adguard With `Cloudflare(DoH&DoT)` â•¸

* In AdGuard homepage under settings select "Dns settings"

* Delete everything from "Upstream" and "Bootstrap DNS" server options and:
 
  * For `DNS over TLS(DoT)` add `127.0.0.1:53` in both "Upstream" and "Bootstrap DNS" server fields
  * For `DNS over HTTPS(DoH)` add `127.0.0.1:5053` in both "Upstream" and "Bootstrap DNS" server fields
  * For `TLS forwarder(stubby)` add `127.0.0.1:8053` in both "Upstream" and "Bootstrap DNS" server fields

* `IMPORTANT:` You need to check "<a href="https://adguard.com/en/blog/in-depth-review-adguard-home.html#dns"><b>Parallel Request</b></a>" option. Sometimes you get a hit and miss with DoH or DoT from <a href="https://1.1.1.1/help"><b>1.1.1.1</b></a> on pc/windows browsers upon refreshing page multiple times, but it don't seem to have that issue on android browsers. But when <a href="https://github.com/AdguardTeam/AdGuardHome/issues/1678#issuecomment-629555747"><b>Fastest IP Address</b></a> option is selected the whole issue stops but have slower response time on websites. But with <i><b>Parallel Request</b></i> its noticeably faster browsing/loading times. In my opinion 1.1.1.1 website sometimes `don't detect DoH or DoT in time because of browser windows architecture ?ğŸ¤”`(<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/issues/2"><b>Issue #2</b></a>) Maybe it will resolve itself or i'll find the problem from adgaurdhome team.

<p align="center">
 <img src="https://i.imgur.com/Ug4Euou.jpg" width=650px height=370px>
 
* Then in DNS setting look for DNS cache configuration section and set cache size to `0` (caching is already handled by the Unbound)

<p align="center">
 <img src="https://i.imgur.com/8Q5Zb0M.jpg" width=650px height=370px>

* You need to restart unbound & stubby and check status:
  
      sudo systemctl restart unbound stubby ; systemctl status unbound stubby -l
 
 <p align="center">
 <img src="https://i.imgur.com/7zIpWP2.jpg" width=650px height=370px>

#### Thats it. Now go to https://1.1.1.1/help in browser and you should see these options output 'Yes'. 
- [x] Connected to 1.1.1.1
- [x] DNS over HTTPS(DoH)
- [x] DNS over TLS(DoT)
- [ ] DNS over WARP
<p align="center">
 <img src="https://i.imgur.com/2S3IH5H.jpg" width=650px height=370px>

#### Other sites to check security
https://browserleaks.com/dns - should show all connected to "Cloudflare"

https://www.cloudflare.com/ssl/encrypted-sni/ - "Secure DNS / DNSSEC / TLS 1.3" should all be a green tick

https://dnssec.vs.uni-due.de/ - should say "Yes, your DNS resolver validates DNSSEC signatures"
 
**If you do not see things correct check your browser `dns` and `proxy` settings**
  
**[â¬† BACK TO TOP â¬†](#contents)**

#
<p align="center">
 <b>ğŸ‘£ STEP 5 ğŸ‘£</b>

<h1 align="center"><b><i>â˜· WireGuard Install â˜·</b></i> </h1>

**Before installing WireGuard**, if you do not have a static ip you need to get a free `Dynamic DNS Subdomain` or else your external IP address most likely changes dynamically from your ISP ever so often and for that reason you'll need to set up a dynamic DNS service. ğŸ‘‰ğŸ‘‰ **_â–“â–’â–‘Use this <a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Dns-Service-Guide.md"><b>INSTRUCTION HERE</b></a>â–‘â–’â–“_** ğŸ‘ˆğŸ‘ˆ. Or else skip the step.

We also need to set up port fowarding on your router so we can access wireguard outside of our network like in a coffee shop hotspot or your mobile data
TYPE | VALUE     
------------ | -------------
Device | Raspberry Pi's hostname or IP
Protocol | UDP
Port range | 51820-51820
Outgoing port | 51820
Permit Internet acces(if have) | yes 

My ğŸ‘‡routerğŸ‘‡ port setting. Yours maybe different but you'll get it. Remember Google ğŸ”search engineğŸ” is your friend. If you cannot connect from a outside network that means isp has blocked outcoming connections, you can call them and ask nicely to get it working..

<p align="center">
 <img src="https://i.imgur.com/9LBEk1i.jpg">
 
***
ğŸ‘ŠBIG THANKSğŸ‘Š for this installation script from <a href="https://github.com/Nyr/wireguard-install"><b>Nyr</b></a>. Follow to keep updated.

Run in terminal 
    
    wget https://git.io/wireguard -O wireguard-install.sh && sudo bash wireguard-install.sh
    
* The script is going to ask you for Public IPv4/hostname for the VPN. _If_ you have static ip then continue or else type the dynamic DNS domain that you created from the <a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Dns-Service-Guide.md"><b>instructions</b></a>. For example:trinibvpn.freeddns.org

* For port option `press enter` for default 51820. For client name, just put any name you want, and for DNS use option 3 (`1.1.1.1`) for now. We will configure `adguard/unbound/cloudflare` with the vpn after its finished installed

<p align="center">
 <img src="https://i.imgur.com/WUNZIK4.jpg">

* Wait until the installation is finished and QR code to show, don't close. But if you do, to `regenerate qrcode`, enter in terminal but replacing just the name `yourclientname.conf` file to yours: 

      sudo cp /root/yourclientname.conf /home/pi && sudo qrencode -t ansiutf8 < yourclientname.conf

`IMPORTANT:` You will need to add a new user/client for each device you use with the VPN. To add a new user, simply re-run the script and create user with different client name.
                                                                                                   
## If you want to use _OpenVPN_ instructions are <a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md"><b>ğŸ‘‰hereğŸ‘ˆ</b></a>

#
### â•¸ Connecting To The VPN To Android/IOS Phone â•¸

Install the WireGuard app from Google Play or App Store

Wireguard (Google Play): https://play.google.com/store/apps/details?id=com.wireguard.android

Wireguard (App Store): https://apps.apple.com/us/app/wireguard/id1441195209

You need to scan the QR code shown in the terminal with Wireguard app, select the `+ button` and use the option `Scan from QR code` to install configuration.

`IMPORTANT`: Enable **kernel module backend** in settings

<p align="left">
 <img src="https://i.imgur.com/R4qbiOQ.jpg" width=250px height=350px>

### â•¸ Connecting To The VPN From A PC (Windows) â•¸

WireGuard for windows: https://download.wireguard.com/windows-client/wireguard-installer.exe

Tunsafe (getting far faster speed with *Tunsafe beta* than wireguard on windows): https://tunsafe.com/downloads/TunSafe-1.5-rc2.exe

* Create `new text document` with any name on pc to copy&paste the text from wireguard client configuration file.

* To see text in client config file, type in terminal:
  
      sudo cat /root/yourclientname.conf
  
* Highlight all the text, copy and paste it in the txt file on pc and save. Then rename the extention from `txt` to `conf`. Now you have config file for that wireguard client.
          
* You can now import the config file to wireguard or tunsafe windows app (import from file option).

## â•¸ Configure WireGuard With `Adguard/Unbound/Cloudflare` â•¸

_Remember this is for when you are connected to WireGuard VPN on an outside network or at home 24/7 cause you already have AdGuard/Unbound/Cloudflare set up and running on your devices manually._ (no issue having both set up. **Just remember with wireguard you will lose about 40-50% of wifi speed(not ethernet cable) speed cause the process of tunneling through pi to router to devices**)

* In wireguard app, select your tunnel and select edit (pencil on top right)

* Under Dns servers enter `pi's ip` and save

<p align="center">
 <img src="https://i.imgur.com/UC0vWfE.jpg" width=450px height=500px>  
 
 
 ### Limit traffic for faster speed *only when connected to wifi*
 
* `IMPORTANT`: Delete in allowed IPs "0.0.0.0/0, ::/0" option because it routes all traffic to your home network which will be slow. You need send traffic through your addresses only. (Only when connected directly with ethernet cable leave in allowed ip `0.0.0.0/0, ::/0` cause i don't seem to lose any speed)
 
* First you need to replace it with your network gateway but setting the last number to a zero and <a href="https://www.google.com/search?q=prefix+length+explained&client=firefox-b-d&sxsrf=ALeKk036Jc9vJl73zVXf0yyZs5UlKRlNRQ%3A1621083125589&ei=9cOfYI66I5-qwbkPkdWxkAk&oq=prefix+length+explained&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEAcQHjoHCCMQsAMQJzoHCAAQRxCwA1CUJ1iUJ2CiKmgBcAJ4AIABsAGIAdQCkgEDMC4ymAEAoAEBqgEHZ3dzLXdpesgBCcABAQ&sclient=gws-wiz&ved=0ahUKEwjOiOie3cvwAhUfVTABHZFqDJIQ4dUDCA0&uact=5"><b>prefix lenght</b></a> to 24. For example: `192.168.1.1/24` to `192.168.1.0/24` or like my isp router `192.168.100.1/24` to `192.168.100.0/24`. **Now I only lose 25% speed**ğŸ˜ (ps. using 5g network)

<p align="center">
 <img src="https://i.imgur.com/x4m6Pbl.jpg" width=450px height=500px>

### PLEASE READ !! , BE AWARE !! 
`IMPORTANT`: _If your network has ip addresses for devices that ends with a number more than 24(most likely), for example: 192.168.100.`999`, you will not be able to route properly from outside network because applying 24 only allows numbers 1 through 24. You need to instead put `0` to route out of the 24 range, for example : `192.168.100.0/0`_. 
 
Or you can change ip range on your router (in my experience you might get a tiny bit better speeds cause it will not route unnecessary allowed ip addresses over the 24 range).
<p align="center">
 <img src="https://i.imgur.com/ZZ4aMUI.jpg" width=750px height=550px>
 
## IPV6
If you are using IPv6, when connected to wifi you need to enter in WireGuard allowed IPs `fe80::1/0` as well. For example `192.168.100.0/0, fe80::1/0`

When connected to ethernet cable on a windows pc, you need to enter pi's IPv6 address in "Internet Protocol Version 6(TCP/IPv6)" preferred DNS server. Enter in terminal `ifconfig`, under global> inet6 to get pi ipv6 address. If you see two inet6(global&link), enter global not link. 
 
Then go to https://ipv6leak.com/ and you should see "_Your IPv6 is not leaking_".
#
 
<h1 align="left"><a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/Disable-All-IPv6.md"><b>Disable all IPv6</b></a></h2>

#
## How do you know if wireguard vpn is really working ??
For **windows** download <a href="https://www.wireshark.org/#download."><b>Wireshark</b></a>

Once downloaded you can use the application to inspect your data packets where the protocol is set to the one used by Wireguard VPN. When a packet traffic is `encrypted`, it can be read  like this for example:
<p align="center">
 <img src="https://i.imgur.com/Tn4M47R.jpg">

For **android** you can use <a href="https://play.google.com/store/apps/details?id=com.emanuelef.remote_capture&hl=en&gl=US"><b>PCAPdroid</b></a>. You should see all connections `closed` and status showing all DNS and not any TLS connections in all apps (open and use apps for PCAPdroid to scan).
 
**[â¬† BACK TO TOP â¬†](#contents)**

#
<h1 align="center"><b><i>â˜· Auto Update Pi â˜·</b></i> </h1>

* Open new sh file called update and copy&paste text from <a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/update.sh"><b>ğŸ‘‰hereğŸ‘ˆ</b></a>

      sudo nano update.sh
      
* Set permission

      sudo chmod 700 update.sh
      
* Open cron file by entering in command line `crontab -e`, copy&paste job command line below at the bottom of cron file and save.

      0 3 * * WED sudo ./update.sh 2>&1 >/home/pi/updatelog
      
Pi will now update every Wednesday at 3am. Or you can go to https://crontab.guru/ and set your own time schedule.

Adjust pi's date/timezone enter in terminal:

    sudo dpkg-reconfigure tzdata
    
or set manually
    
    sudo date -s "25 DEC 2012 11:14:00"

#
<h1 align="center"><b><i>â˜· Log2Ram Install â˜·</b></i> </h1>

One of the most significant advantages of offloading your RAM is that it improves your **SD Cardâ€™s potential lifespan**.
Log files are one of the things written to most by the various pieces of software you install.
By pushing the files to your RAM, you can control how often they are written to the SD Card. You will still be able to access these files on the RAM as if they sat on your SD Card.

Copy and paste this line in terminal:

    wget https://git.io/log2ram -O Log2Ram-Script.sh && sudo chmod +x Log2Ram-Script.sh && sudo ./Log2Ram-Script.sh
    
#
<h1 align="center"><b><i>â˜· Turn Off Pi LED Lights â˜·</b></i> </h1>

I guess power to LEDs will impact unnecessary electricty and heat ğŸ¤·ğŸ˜…. No need for it anyways if just using it as a network server. Open cron file by entering in command line `crontab -e`, copy&paste job command line below at the bottom of cron file and save.
     
   Green 
    
    @reboot echo none | sudo tee /sys/class/leds/led0/trigger
   Red
    
    @reboot echo none | sudo tee /sys/class/leds/led1/trigger

Reboot pi.
    
#
<h1 align="center"><b><i>â˜· Secure Your Raspberry Pi â˜·</b></i> </h1>
<p align="center">
<a href="https://gist.github.com/boseji/c9e91ff3bd0b3cfb62a5e260fe505374"><img src="https://i.imgur.com/a9JQVls.png" width=80px height=90px></a>
<p align="center">
<a href="https://gist.github.com/boseji/c9e91ff3bd0b3cfb62a5e260fe505374"><b>LINK</b></a>
 
**[â¬† BACK TO TOP â¬†](#contents)**

***

<p align="center">
<b>ğŸ‰ğŸ‰ THAT'S IT !! ğŸ‰ğŸ‰ YOUR FINISH ğŸ‘ŒğŸ‘Œ
<p align="center">
<b>ANY ISSUES, FIXES OR TIPS TO MAKE THESE PROJECTS BETTER PLEASE CONTRIBUTEğŸ¤–</b>
