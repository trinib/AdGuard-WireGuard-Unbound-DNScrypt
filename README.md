# ![logo](https://i.imgur.com/zqJELkl.png)
<p align="center">
 <img src="https://img.shields.io/badge/License-MIT-blue.svg">
 <img src="https://badges.frapsoft.com/os/v3/open-source.svg?v=103">
 <img src="http://ForTheBadge.com/images/badges/built-with-love.svg">
 <img src="https://img.shields.io/badge/badges-awesome-green.svg">
 <img src="https://img.shields.io/badge/Stay-Safe-red?logo=data:image/svg%2bxml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgNTEwIDUxMCIgaGVpZ2h0PSI1MTIiIHZpZXdCb3g9IjAgMCA1MTAgNTEwIiB3aWR0aD0iNTEyIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxnPjxnPjxwYXRoIGQ9Im0xNzQuNjEgMzAwYy0yMC41OCAwLTQwLjU2IDYuOTUtNTYuNjkgMTkuNzJsLTExMC4wOSA4NS43OTd2MTA0LjQ4M2g1My41MjlsNzYuNDcxLTY1aDEyNi44MnYtMTQ1eiIgZmlsbD0iI2ZmZGRjZSIvPjwvZz48cGF0aCBkPSJtNTAyLjE3IDI4NC43MmMwIDguOTUtMy42IDE3Ljg5LTEwLjc4IDI0LjQ2bC0xNDguNTYgMTM1LjgyaC03OC4xOHYtODVoNjguMThsMTE0LjM0LTEwMC4yMWMxMi44Mi0xMS4yMyAzMi4wNi0xMC45MiA0NC41LjczIDcgNi41NSAxMC41IDE1LjM4IDEwLjUgMjQuMnoiIGZpbGw9IiNmZmNjYmQiLz48cGF0aCBkPSJtMzMyLjgzIDM0OS42M3YxMC4zN2gtNjguMTh2LTYwaDE4LjU1YzI3LjQxIDAgNDkuNjMgMjIuMjIgNDkuNjMgNDkuNjN6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTM5OS44IDc3LjN2OC4wMWMwIDIwLjY1LTguMDQgNDAuMDctMjIuNjQgNTQuNjdsLTExMi41MSAxMTIuNTF2LTIyNi42NmwzLjE4LTMuMTljMTQuNi0xNC42IDM0LjAyLTIyLjY0IDU0LjY3LTIyLjY0IDQyLjYyIDAgNzcuMyAzNC42OCA3Ny4zIDc3LjN6IiBmaWxsPSIjZDAwMDUwIi8+PHBhdGggZD0ibTI2NC42NSAyNS44M3YyMjYuNjZsLTExMi41MS0xMTIuNTFjLTE0LjYtMTQuNi0yMi42NC0zNC4wMi0yMi42NC01NC42N3YtOC4wMWMwLTQyLjYyIDM0LjY4LTc3LjMgNzcuMy03Ny4zIDIwLjY1IDAgNDAuMDYgOC4wNCA1NC42NiAyMi42NHoiIGZpbGw9IiNmZjRhNGEiLz48cGF0aCBkPSJtMjEyLjgzIDM2MC4xMnYzMGg1MS44MnYtMzB6IiBmaWxsPSIjZmZjY2JkIi8+PHBhdGggZD0ibTI2NC42NSAzNjAuMTJ2MzBoMzYuMTRsMzIuMDQtMzB6IiBmaWxsPSIjZmZiZGE5Ii8+PC9nPjwvc3ZnPg==">
 
<p align="center">
 <img src="https://github.com/websemantics/bragit/blob/master/demo/img/heart.svg" height=40px >
 <img src="https://stars.medv.io/Naereen/badges.svg">

</p>
<p align="center">
    <a href="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge" alt="GitHub Repo stars">
        <img src="https://img.shields.io/github/stars/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=FFD700&style=for-the-badge"></a>
    <a href="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge" alt="GitHub forks">
        <img src="https://img.shields.io/github/forks/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=00a671&style=for-the-badge"></a>
    <a href="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge" alt="GitHub watchers">
        <img src="https://img.shields.io/github/watchers/trinib/AdGuard-WireGuard-Unbound-Cloudflare?color=9700b2&style=for-the-badge"></a>
</p>
 
 
<h1 align="center"><b>A step by step üìú guide for these</b> 
<h1 align="center"><b> üÖµüÜÅüÖ¥üÖ¥ network üì° security projects to work together on a</b>
<h1 align="center"><b>ùì° ùìê ùì¢ ùìü ùìë ùìî ùì° ùì° ùì® ‚Ñô ùïÄ ü•ß</b></h1>

#### _<a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>AdGuard</b></a>_ ‚´∏ Adblocker for your devices at home ( <a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md#how-does-adguard-home-compare-to-pi-hole"><b>_AdGuard compared to Pi-Hole_</b></a> )
#### _<a href="https://www.wireguard.com/"><b>WireGuard</b></a>_ ‚´∏ A Vpn Server at home accessable from any outside network(IPv4 & IPv6)
#### _<a href="https://www.nlnetlabs.nl/projects/unbound/about/"><b>Unbound</b></a> with <a href="https://dnsprivacy.org/dns_privacy_daemon_-_stubby/about_stubby/"><b>Stubby</b></a>_ ‚´∏ A Validating, Recursive, Caching DNS Resolver
#### _<a href="https://www.cloudflare.com/learning/what-is-cloudflare/"><b>Cloudflare</b></a>_ ‚´∏ Better Performance & Security when browsing websites(DoT & DoH)
#
<p align="center">
 <img src="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/assets/images/awcu.gif" width= "800">
  
***
#
<h1 align="center">üìà Test results with <a href="https://docs.oracle.com/en-us/iaas/Content/DNS/Tasks/testingdnsusingdig.htm"><b>BIND's DNS Tool </b></a> üìà</h1>

<b>Query Time in milliseconds:</b>
- Adguard default DNS resolvers - `60-70 msec`
- Default Cloudflare/Quad9/Google DNS Resolvers - `50-70 msec`
- This set up/configuration -  `5-10 msec`
 
<details><summary><b>üé•Video Previewsüé•<img src="https://media.giphy.com/media/WT5h7PgVSScLLKtMaS/giphy.gif" width=50px height=40px></b></summary>
<p>

### „Äêadguard default DNS„Äë <i>VS</i> „Äê‚≠êthis set up‚≠ê„Äë
 
https://user-images.githubusercontent.com/18756975/150230438-b767e86f-4e18-4791-b5fe-0813615a37a3.mp4
 
### Standard „Äêcloudflare/quad9/google„Äë DNS resolvers
 
https://user-images.githubusercontent.com/18756975/150319049-3d8acdc9-624f-4b60-8ee2-b80227522252.mp4

</p>
</details>

***
 
<h2><p align="center">
‚è∞Last Checked : 25 Feb 2022‚è∞</h2>
 
<div align="center">
 
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;  Projects  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;           |   &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Status &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;         |
  :---:             |     :---: 
AdGuard Home        |       ‚úÖ
Unbound             |       ‚úÖ
Cloudflare          |       ‚úÖ
Stubby              |       ‚úÖ
WireGuard           |       ‚úÖ    

</div>
<div>

#
# Contents
- <a href="https://git.io/About">About</a> <img src="https://github.com/seanprashad/slackmoji/blob/master/emoji/parrots/party-nyan.gif" width=20px height=20px>
- [Requirements](#requirements)
- [Installing Pi operating system](#-installing-os-image-to-sdcard--) <img src="https://www.vectorlogo.zone/logos/raspberrypi/raspberrypi-icon.svg" width=20px height=20px>
  - [Logging into Pi system [Headlessly]](#-logging-into-pi-system-headlessly-)
- [Installing AdGuard](#-adguard-install--) <img src="https://www.vectorlogo.zone/logos/adguard/adguard-icon.svg" width=20px height=20px>
  - [Set up your devices to work with Adguard](#-set-up-your-devices-to-work-with-adguard-)
  - [Setting up AdGuard blocklist](#-setting-up-adguard-blocklist-)
    - [Add/Remove multiple URLs to blocklist at once](#-addremove-multiple-urls-)
- [Installing Unbound](#-unbound-install--) <img src="https://www.privacyguides.org/assets/img/legacy_svg/3rd-party/unbound.svg" width=20px height=20px>
- [Installing Cloudflare](#-cloudflare-install--) <img src="https://www.vectorlogo.zone/logos/cloudflare/cloudflare-icon.svg" width=20px height=20px>
  - [Install Cloudflare (DoH)](#-install-cloudflare-on-pi-with-doh-)
  - [Configure Cloudflare on Unbound (DoT)](#-configure-cloudflare-on-unbound-with-dot-)
  - [Configure Stubby (TLS Forwarder)](#-configure-stubby-for-unbound-)
  - [Configure AdGuard with Cloudflare (DoH&DoT)](#-configure-adguard-with-cloudflaredohdot-)
- [Installing WireGuard](#-wireguard-install--) <img src="https://www.vectorlogo.zone/logos/wireguard/wireguard-icon.svg" width=20px height=20px>
  or <a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md">OpenVPN(slower)</a> <img src="https://i.imgur.com/Agstbe5.png" width=20px height=20px>
  - [Connecting to the VPN to Android/IOS Phone](#-connecting-to-the-vpn-to-androidios-phone-)
  - [Connecting to the VPN from a PC (Windows)](#-connecting-to-the-vpn-from-a-pc-windows-)
  - [Configure Wireguard with AdGuard/Unbound/Cloudflare](#-configure-wireguard-with-adguardunboundcloudflare-)
    - [Limit traffic](#limit-traffic)
    - [IPv6 setup](#ipv6)
- <a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/Disable-All-IPv6.md">Disable all IPv6</a>
- [Test Vpn](#how-do-you-know-if-wireguard-vpn-is-really-working-) <img src="https://i.imgur.com/6Yf8Zra.png" width=20px height=20px>
- [Auto update your Pi](#-auto-update-pi--)
- [Improving your SD Card‚Äôs potential lifespan](#-log2ram-install--)
- [Turn Off Pi LEDs](#-turn-off-pi-led-lights--)
- [Securing your Raspberry Pi](#-secure-your-raspberry-pi--)

#
# Requirements
   
   * A Raspberry Pi 3 or 4 version
   * A router that supports port forwarding(Most Can)
   * MicroSD USB card reader
   * MicroSD card (8GB or bigger, at least Class 4)
   * Ethernet cable
   * (Optional if using monitor) MicroHDMI-(RPi 4) or HDMI-(RPi 3)

#
<p align="center">
  <b><img src="https://github.com/seanprashad/slackmoji/blob/master/emoji/party/party-footprints.png" width=20px height=20px> STEP 1 <img src="https://github.com/seanprashad/slackmoji/blob/master/emoji/party/party-footprints.png" width=20px height=20px></b>

<h1 align="center"><b><i>‚ò∑ Installing OS Image To SDcard ‚ò∑</b></i> </h1>

This tutorial is based on Raspberry Pi OS (32bit or 64bit), but you can use any linux <a href="https://github.com/thibmaek/awesome-raspberry-pi#os-images"><b>operating system</b></a> and hardware you prefer with some tweaking if you know what you are doing (Raspberry Pi OS is most simple and recommended for Pi).

Raspberry Pi OS comes in Desktop and Lite versions(I use lite 64bit). You can set Raspberry Pi up with a monitor/keyboard/mouse, or set it up ‚Äúheadlessly‚Äù from a terminal.

Install balenEtcher and download pi image to write on the microSD card.

* Download Raspberry Pi OS: https://www.raspberrypi.org/software/operating-systems/

* Download balenaEtcher: https://www.balena.io/etcher/

After you have `Etcher` installed and `Raspberry Pi OS` file downloaded on your computer, you can now insert the SD card with microSD USB card reader into your computer.

Launch Etcher and choose the Raspberry Pi OS image that you downloaded, select your microSD card and click ‚ÄúFlash‚Äù.

<p align="center">
 <img src="https://i.imgur.com/tbB3VIK.jpg">

After flashing is done, look in "This PC‚Äù for a disk name ‚Äúboot or usb drive‚Äù (replug usb card reader if not seen). Go to that disk, create a new text file called **_`ssh without 'txt' extention`_**. BE CAREFUL, it's not ‚Äússh.txt‚Äù, it's ‚Äússh‚Äù without the extension. You need to disabled ‚ÄúHide extensions for known file types‚Äù option in the File Exporer Options if you don't see them.

<p align="center">
 <img src="https://i.imgur.com/eV6uMbz.jpg">

Now put the SD card into the Raspberry Pi, plug your Ethernet cable and boot up.

## ‚ï∏ Logging into Pi system [Headlessly] ‚ï∏

* Now you need to wait for a minute for pi's first boot up

* Open browser and log in your router's panel page

* Find list all of the devices connected to the network and copy the IP address of the Raspberry Pi (it will most likely have the hostname `raspberrypi`)

* Open Terminal on your host machine. You can use PowerShell on Windows or RaspController for Android

Type the following command:

    ssh pi@pi's ip address
    
You can use right mouse button to paste text in Windows PowerShell.

Type ‚Äúyes‚Äù for fingerprint question, and type "raspberry" for a password. The passwords will be invisible when typing in linux interface. You can type **_`sudo passwd pi`_** to change password.

<p align="center">
 <img src="https://i.imgur.com/Wf30jxG.jpg">

Run in terminal:
 
    sudo apt update -y && sudo apt upgrade -y
    
*_WAIT FOR UPDATE TO FINISH & RESTART PI. THEN CONTINUE TO NEXT STEP_*.....

    sudo reboot
 
**[‚¨Ü BACK TO TOP ‚¨Ü](#contents)**

#
<p align="center">
 <b><img src="https://github.com/seanprashad/slackmoji/blob/master/emoji/party/party-footprints.png" width=20px height=20px> STEP 2 <img src="https://github.com/seanprashad/slackmoji/blob/master/emoji/party/party-footprints.png" width=20px height=20px></b>

<h1 align="center"><b><i>‚ò∑ AdGuard Install ‚ò∑</b></i> </h1>

This installation script is from <a href="https://github.com/AdguardTeam/AdGuardHome/blob/master/README.md"><b>AdGuard Home</b></a> main project. Follow to keep updated.

Run the following command in your terminal:

    curl -s -S -L https://raw.githubusercontent.com/AdguardTeam/AdGuardHome/master/scripts/install.sh | sh -s -- -v

* When installation is finished a window will pop up in terminal showing the different links to YOUR Adguard home page(Get Started)

* `IMPORTANT:` In Listen Interfaces option choose `Eth0` and select next

<p align="center">
 <img src="https://i.imgur.com/Wa00lDp.jpg" width=580px height=690px>

* Set up username and password

* You should now be in Adguard home panel

* `IMPORTANT:` In general settings, set "Query logs retention" to `24 hours` (I read that for some people logs fill up and slow down pi and needing a restart everytime)

## ‚ï∏ Set Up Your Devices To Work With Adguard ‚ï∏

- For Android/Apple, go to wifi advanced settings and select static option. In `DNS 1` field enter "pi's ip" address

<p align="center">
 <img src="https://i.imgur.com/nxpiqDw.jpg" width=450px height=580px>

- For PC/Windows
 
   - <i>IPV4</i>
 
   Go to network settings / change adpater options and right click in properties then select "Internet Protocol Version 4(TCP/IPv4)". Enter pi's ip address in `Preferred DNS` server 

   - <i>IPV6 (needed for `DoH` & `DoT` to work later on in guide if using ipv6 on your router)</i>
 
    Go to "Internet Protocol Version 6(TCP/IPv6)" Enter `::1`
 
 `OPTIONAL:` <i>You can add a backup dns in the alternative fields</i>
 
<p align="center">
 <img src="https://i.imgur.com/8gsDk3z.jpg">

## ‚ï∏ Setting Up AdGuard Blocklist ‚ï∏
 
In AdGuard homepage under filters, select DNS blocklist section for adding urls.
 
<p align="center">
 <img src="https://i.imgur.com/shrtJLD.png">

You can search Google for different blocklist.Here is my custom <a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/My-Blocklist.txt"><b>blocklist</b></a> with my urls.
 
`IMPORTANT:` Some blocklist can block some important contents or websites. To unblock go "Query Log" section and will see _unblock_ option when cursor is hovered over a query, putting unblocked wesites it in "Custom filtering rules" example: `@@||bitly.com^$important`. Look for client ip & time.
 
<p align="center">
 <img src="https://i.imgur.com/1gZibwD.png">

## ‚ï∏ Add/Remove Multiple URLs ‚ï∏

You can only add one by one url in dns blocklist in adguard for now but there is a python script to add multiple urls together.

Open new py file and call it bulkurls.py:

    nano /home/pi/bulkurls.py
    
Then copy and past text from <a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/bulkurls.py"><b>bulkurls.py</b></a> file and save (control+x then y then enter) **DON'T FORGET TO READ INSTRUCTIONS FROM TEXT IN IT**.
 
To **remove** you need to change `add` in <a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/62ba01ed8ed3a5bc5294b9fe7ee38c3e83ae1b86/bulkurls.py#L150"><b>second of last line</b></a> to `remove` in bulkurls.py file.
 
Go to https://d3ward.github.io/toolz/adblock.html to test if ads are blocking <img src="https://i.imgur.com/Q5oO9EY.png" width=100px height=80px>
 
**[‚¨Ü BACK TO TOP ‚¨Ü](#contents)**

#
<p align="center">
 <b><img src="https://github.com/seanprashad/slackmoji/blob/master/emoji/party/party-footprints.png" width=20px height=20px> STEP 3 <img src="https://github.com/seanprashad/slackmoji/blob/master/emoji/party/party-footprints.png" width=20px height=20px></b>

<h1 align="center"><b><i>‚ò∑ Unbound Install ‚ò∑</b></i> </h1>

Run the following command in your terminal:

    sudo apt install unbound -y
    
For recursively querying a host that is not cached as an address, the resolver needs to start at the top of the server tree and query the root servers, to know where to go for the top level domain for the address being queried. Unbound comes with default builtin hints.

    wget -O root.hints https://www.internic.net/domain/named.root && sudo mv root.hints /var/lib/unbound/
    
`IMPORTANT:` This needs to update every 6 months. To _**autoupdate**_ root.hints every 6 months you need to create a cron job.

Enter in command line `crontab -e`, it will ask Select an editor(choose 1) and paste these lines at the bottom of crontab and save (control+x then y then enter):

    1 0 1 */6 * wget -O root.hints https://www.internic.net/domain/named.root
    2 0 1 */6 * sudo mv root.hints /var/lib/unbound/
    
<p align="center">
 <img src="https://i.imgur.com/26ro62t.jpg">
 
**[‚¨Ü BACK TO TOP ‚¨Ü](#contents)**

#    
<p align="center">
 <b><img src="https://github.com/seanprashad/slackmoji/blob/master/emoji/party/party-footprints.png" width=20px height=20px> STEP 4 <img src="https://github.com/seanprashad/slackmoji/blob/master/emoji/party/party-footprints.png" width=20px height=20px></b>   

<h1 align="center"><b><i>‚ò∑ Cloudflare Install ‚ò∑</b></i> </h1>

## ‚ï∏ Install Cloudflare On Pi With `(DoH)` ‚ï∏

Install cloudflare with DNS over HTTPS(DoH), follow these üëâ <a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Cloudflare-DoH-Setup.md"><b>INSTRUCTIONS</b></a> üëà.

## ‚ï∏ Configure Cloudflare On Unbound With `(DoT)` ‚ï∏

Create unbound configuration file by entering in command prompt:
      
    sudo nano /etc/unbound/unbound.conf.d/unbound.conf

And copy and paste all the text from <a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/unbound.conf"><b>unbound.conf</b></a> file and save (control+x then y then enter).

## ‚ï∏ Configure Stubby For Unbound ‚ï∏

Use Unbound for caching and stubby for TLS forwarder. Install stubby:

    sudo apt install stubby -y
    
Remove and re-create stubby.yaml file and copy/paste all the text from <a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/stubby.yml"><b>üëâ this stubby config üëà</b></a> and save. (`cd $h` to return to home folder when finish).

    cd /etc/stubby/ && sudo rm stubby.yml && sudo nano stubby.yml
    
`Tip:` You can also add more DNS servers by uncommenting the needed lines
 
 ## ‚ï∏ Configure Adguard With `Cloudflare(DoH&DoT)` ‚ï∏

* In AdGuard homepage under settings select "Dns settings"

* Delete everything from "Upstream" and "Bootstrap DNS" server options and:
 
  * For `DNS over TLS(DoT)` add `127.0.0.1:53` in both "Upstream" and "Bootstrap DNS" server fields
  * For `DNS over HTTPS(DoH)` add `127.0.0.1:5053` in both "Upstream" and "Bootstrap DNS" server fields
  * For `TLS forwarder(stubby)` add `127.0.0.1:8053` in both "Upstream" and "Bootstrap DNS" server fields

* `IMPORTANT:` You need to check "<a href="https://adguard.com/en/blog/in-depth-review-adguard-home.html#dns"><b>Parallel Request</b></a>" option for dns resolvers to work simultaneously.
 
<p align="center">
 <img src="https://i.imgur.com/Ug4Euou.jpg" width=650px height=370px>
 
* Then in DNS setting look for DNS cache configuration section and set cache size to `0` (caching is already handled by the Unbound)

<p align="center">
 <img src="https://i.imgur.com/8Q5Zb0M.jpg" width=650px height=370px>

* You need to restart unbound & stubby and check status:
  
      sudo systemctl restart unbound stubby ; systemctl status unbound stubby -l
 
 <p align="center">
 <img src="https://i.imgur.com/7zIpWP2.jpg" width=650px height=370px>
  
### `IMPORTANT:` Windows system & Android browsers need some tweaking to `stabilize` dns resolvers..Linux works fine<i>(tested on mint)</i>
  
### Windows 
  
* Install <a href="https://mayakron.altervista.org/support/acrylic/Home.htm"><b>Acrylic DNS Proxy</b></a>
  
* Go to `C:\Program Files (x86)\Acrylic DNS Proxy` and open `AcrylicConfiguration.ini` file. Delete everything and copy these <a href="https://raw.githubusercontent.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/main/AcrylicConfiguration.ini"><b>üëâSETTINGSüëà</b></a> only change _**PrimaryServerAddres**_ to your pi's address.
  
* In same folder run `RestartAcrylicService.bat` & `PurgeAcrylicCacheData.bat`
  
`TIP:` Troubleshoot IP/DNS Commands
 ```
ipconfig /release
ipconfig /renew
ipconfig /flushdns
 ```
### Android
  
* In whatever browser you use, turn **off** `Use Secure DNS` option.

#### _Thats it_. Now go to https://1.1.1.1/help in browser and you should see these options output 'Yes'. 
- [x] Connected to 1.1.1.1
- [x] DNS over HTTPS(DoH)
- [x] DNS over TLS(DoT)
- [ ] DNS over WARP
<p align="center">
 <img src="https://i.imgur.com/2S3IH5H.jpg" width=650px height=370px>

#### Other sites to check security
https://browserleaks.com/dns - should show all connected to "Cloudflare"

https://www.cloudflare.com/ssl/encrypted-sni/ - "Secure DNS / DNSSEC / TLS 1.3" should all be a green tick

https://dnssec.vs.uni-due.de/ - should say "Yes, your DNS resolver validates DNSSEC signatures"
  
**[‚¨Ü BACK TO TOP ‚¨Ü](#contents)**

#
<p align="center">
 <b><img src="https://github.com/seanprashad/slackmoji/blob/master/emoji/party/party-footprints.png" width=20px height=20px> STEP 5 <img src="https://github.com/seanprashad/slackmoji/blob/master/emoji/party/party-footprints.png" width=20px height=20px></b>

<h1 align="center"><b><i>‚ò∑ WireGuard Install ‚ò∑</b></i> </h1>

**Before installing WireGuard**, if you do not have a static ip you need to get a free `Dynamic DNS Subdomain` or else your external IP address most likely changes dynamically from your ISP ever so often and for that reason you'll need to set up a dynamic DNS service. üëâüëâ **_‚ñì‚ñí‚ñëUse this <a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Dns-Service-Guide.md"><b>INSTRUCTION HERE</b></a>‚ñë‚ñí‚ñì_** üëàüëà. Or else skip the step.

We also need to set up port fowarding on your router so we can access wireguard outside of our network like in a coffee shop hotspot or your mobile data
TYPE | VALUE     
------------ | -------------
Device | Raspberry Pi's hostname or IP
Protocol | UDP
Port range | 51820-51820
Outgoing port | 51820
Permit Internet acces(if have) | yes 

My üëárouterüëá port setting. Yours maybe different but you'll get it. Remember Google üîçsearch engineüîé is your friend. If you cannot connect from a outside network that means isp has blocked outcoming connections, you can call them and ask nicely to get it working.

<p align="center">
 <img src="https://i.imgur.com/9LBEk1i.jpg">
 
***
üëäBIG THANKSüëä for this installation script from <a href="https://github.com/Nyr/wireguard-install"><b>Nyr</b></a>. Follow to keep updated.

Run in terminal 
    
    wget https://git.io/wireguard -O wireguard-install.sh && sudo bash wireguard-install.sh
    
* The script is going to ask you for Public IPv4/hostname for the VPN. _If_ you have static ip then continue or else type the dynamic DNS domain that you created from the <a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/Dns-Service-Guide.md"><b>instructions</b></a>. For example:trinibvpn.freeddns.org

* For port option `press enter` for default 51820. For client name, just put any name you want, and for DNS use option 3 (`1.1.1.1`) for now. We will configure `adguard/unbound/cloudflare` with the vpn after its finished installed

<p align="center">
 <img src="https://i.imgur.com/WUNZIK4.jpg">

* Wait until the installation is finished and QR code to show, don't close. But if you do, to `regenerate qrcode`, enter in terminal but replacing just the name `yourclientname.conf` file to yours: 

      sudo cp /root/yourclientname.conf /home/pi && sudo qrencode -t ansiutf8 < yourclientname.conf

`IMPORTANT:` You will need to add a new user/client for each device you use with the VPN. To add a new user, simply re-run the script and create user with different client name.
                                                                                                   
## If you want to use _OpenVPN_ instructions are <a href="https://github.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/blob/main/OpenVPN-Setup.md"><b>üëâhereüëà</b></a>

#
### ‚ï∏ Connecting To The VPN To Android/IOS Phone ‚ï∏

Install the WireGuard app from Google Play or App Store

Wireguard (Google Play): https://play.google.com/store/apps/details?id=com.wireguard.android

Wireguard (App Store): https://apps.apple.com/us/app/wireguard/id1441195209

You need to scan the QR code shown in the terminal with Wireguard app, select the `+ button` and use the option `Scan from QR code` to install configuration.

`IMPORTANT`: Enable **kernel module backend** in settings

<p align="left">
 <img src="https://i.imgur.com/R4qbiOQ.jpg" width=250px height=350px>

### ‚ï∏ Connecting To The VPN From A PC (Windows) ‚ï∏

WireGuard for windows: https://download.wireguard.com/windows-client/wireguard-installer.exe

* Create a `new text document` with any name on pc to copy&paste the text from wireguard client configuration file.

* To see text in client config file, type in terminal:
  
      sudo cat /root/yourclientname.conf
  
* Highlight all the text, copy and paste it in the txt file on pc and save. Then rename the extention from `txt` to `conf`. Now you have config file for that wireguard client.
          
* You can now import the config file to wireguard (import from file option).

## ‚ï∏ Configure WireGuard With `Adguard/Unbound/Cloudflare` ‚ï∏

_Remember this is for when you are connected to WireGuard VPN on an outside network or at home 24/7 cause you already have AdGuard/Unbound/Cloudflare set up and running on your devices manually._ (no issue having both set up fro my experience).
* In wireguard app, select your tunnel and select edit (pencil on top right)

* Under Dns servers enter `pi's ip` and save (IPv4 & IPv6)

<p align="center">
 <img src="https://i.imgur.com/UC0vWfE.jpg" width=450px height=500px>  
  
### Limit traffic
 
With WireGuard you will lose about 50% of internet speed cause the process of tunneling through pi to router to devices**
 
Delete in allowed IPs "0.0.0.0/0, ::/0" option because it routes all traffic to your home network which will be slow. You need send traffic through your addresses only.
 
* First you need to replace it with your network gateway but setting the last number to a zero and <a href="https://www.google.com/search?q=prefix+length+explained&client=firefox-b-d&sxsrf=ALeKk036Jc9vJl73zVXf0yyZs5UlKRlNRQ%3A1621083125589&ei=9cOfYI66I5-qwbkPkdWxkAk&oq=prefix+length+explained&gs_lcp=Cgdnd3Mtd2l6EAMyBggAEAcQHjoHCCMQsAMQJzoHCAAQRxCwA1CUJ1iUJ2CiKmgBcAJ4AIABsAGIAdQCkgEDMC4ymAEAoAEBqgEHZ3dzLXdpesgBCcABAQ&sclient=gws-wiz&ved=0ahUKEwjOiOie3cvwAhUfVTABHZFqDJIQ4dUDCA0&uact=5"><b>prefix lenght</b></a> to 24. For example: `192.168.1.1/24` to `192.168.1.0/24` or like my isp router `192.168.100.1/24` to `192.168.100.0/24`. ~~**Now I only lose 25% speed**üòÅ (ps. using 5g network)~~ 
 
`UPDATE:` After a Wireguard update I do not get a faster speed doing this :( .. but it still makes sense _not_ to use `"0.0.0.0/0, ::/0` with wifi. If anyone knows any tweaks to get a boost, let me know.

<p align="center">
 <img src="https://i.imgur.com/x4m6Pbl.jpg" width=450px height=500px>

### PLEASE READ !! , BE AWARE !! 
`IMPORTANT`: _If your network has ip addresses for devices that ends with a 3 digit number (more than 24), for example: 192.168.100.`999`, you will not be able to route properly from outside network because applying 24 only allows numbers 1 through 24. You need to instead put `0` to route out of the 24 range, for example : `192.168.100.0/0`_. 
 
Or you can change ip range on your router (in my experience you might get a tiny bit better speeds cause it will not route unnecessary allowed ip addresses over the 24 range).
<p align="center">
 <img src="https://i.imgur.com/ZZ4aMUI.jpg" width=750px height=550px>
 
## IPV6
If you are using IPv6, when connected to wifi you need to enter in WireGuard allowed IPs `fe80::1/0` as well. For example `192.168.100.0/0, fe80::1/0`

When connected to ethernet cable on a windows pc, you need to enter `::1` in IPv6 address in "Internet Protocol Version 6(TCP/IPv6)" preferred DNS server.
 
Then go to https://ipv6leak.com/ and you should see "_Your IPv6 is not leaking_".
#
 
<h1 align="left"><a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/blob/main/Disable-All-IPv6.md"><b>Disable all IPv6</b></a></h2>

#
## How do you know if wireguard vpn is really working ??
For **windows** download <a href="https://www.wireshark.org/#download."><b>Wireshark</b></a>

Once downloaded you can use the application to inspect your data packets where the protocol is set to the one used by Wireguard VPN. When a packet traffic is `encrypted`, it can be read  like this for example:
<p align="center">
 <img src="https://i.imgur.com/Tn4M47R.jpg">

For **android** you can use <a href="https://play.google.com/store/apps/details?id=com.emanuelef.remote_capture&hl=en&gl=US"><b>PCAPdroid</b></a>. You should see all connections `closed` and status showing all DNS and not any TLS connections in all apps (open and use apps for PCAPdroid to scan).
 
**[‚¨Ü BACK TO TOP ‚¨Ü](#contents)**

#
<h1 align="center"><b><i>‚ò∑ Auto Update Pi ‚ò∑</b></i> </h1>

* Open new sh file called update and copy&paste text from <a href="https://raw.githubusercontent.com/trinib/Adguard-Wireguard-Unbound-Cloudflare/main/update.sh"><b>üëâhereüëà</b></a>

      sudo nano update.sh
      
* Set permission

      sudo chmod 700 update.sh
      
* Open cron file by entering in command line `crontab -e`, copy&paste job command line below at the bottom of cron file and save.

      0 3 * * WED sudo ./update.sh 2>&1 >/home/pi/updatelog
      
Pi will now update every Wednesday at 3am. Or you can go to https://crontab.guru/ and set your own time schedule.

Adjust pi's date/timezone enter in terminal:

    sudo dpkg-reconfigure tzdata
    
or set manually
    
    sudo date -s "25 DEC 2012 11:14:00"

#
<h1 align="center"><b><i>‚ò∑ Log2Ram Install ‚ò∑</b></i> </h1>

One of the most significant advantages of offloading your RAM is that it improves your **SD Card‚Äôs potential lifespan**.
Log files are one of the things written to most by the various pieces of software you install.
By pushing the files to your RAM, you can control how often they are written to the SD Card. You will still be able to access these files on the RAM as if they sat on your SD Card.

Copy and paste this line in terminal:

    wget https://git.io/log2ram -O Log2Ram-Script.sh && sudo chmod +x Log2Ram-Script.sh && sudo ./Log2Ram-Script.sh
    
#
<h1 align="center"><b><i>‚ò∑ Turn Off Pi LED Lights ‚ò∑</b></i> </h1>

I guess power to LEDs will impact unnecessary electricty and heat ü§∑üòÖ. No need for it anyways if just using it as a network server. Open cron file by entering in command line `crontab -e`, copy&paste job command line below at the bottom of cron file and save.
     
   Green 
    
    @reboot echo none | sudo tee /sys/class/leds/led0/trigger
   Red
    
    @reboot echo none | sudo tee /sys/class/leds/led1/trigger

Reboot pi.
    
#
<h1 align="center"><b><i>‚ò∑ Secure Your Raspberry Pi ‚ò∑</b></i> </h1>
<p align="center">
<a href="https://gist.github.com/boseji/c9e91ff3bd0b3cfb62a5e260fe505374"><img src="https://i.imgur.com/a9JQVls.png" width=80px height=90px></a>
<p align="center">
<a href="https://gist.github.com/boseji/c9e91ff3bd0b3cfb62a5e260fe505374"><b>LINK</b></a>
 
<i>( I just use Fail2Ban and change SSH port )</i>
 
**[‚¨Ü BACK TO TOP ‚¨Ü](#contents)**

***

<p align="center">
<b>üéâüéâ THAT'S IT !! üéâüéâ YOUR FINISH üëåüëå
<p align="center">
<b>ANY ISSUES, FIXES OR TIPS TO MAKE THESE PROJECTS BETTER PLEASE CONTRIBUTEü§ñ</b>
 
***
 
<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif"
<br> 
<br> 
<br> 

<p align="center">
 <img src="https://i.imgur.com/Q07E7SW.gif" width=500px height=30px>

<p align="center">
<a href="https://github.com/trinib/AdGuard-WireGuard-Unbound-Cloudflare/stargazers"><img src="https://reporoster.com/stars/dark/trinib/AdGuard-WireGuard-Unbound-Cloudflare"></a>
 
<p align="center">
<img src="https://user-images.githubusercontent.com/73097560/115834477-dbab4500-a447-11eb-908a-139a6edaec5c.gif" </p>
     

